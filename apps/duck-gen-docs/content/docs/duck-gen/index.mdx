---
title: duck gen
description: Core setup and usage for the Duck Gen compiler extension, currently tested with NestJS.
---

## What is Duck Gen?

Duck Gen is a general-purpose compiler extension in the @gentleduck ecosystem. It scans
server code and emits TypeScript definitions that describe API routes and message keys.
It is designed for multiple frameworks and is currently being tested with NestJS. The goal
is simple: keep server contracts and client types aligned without manual sync work.

## What it generates

- **API route types**: A map of routes with request and response types.
- **Message registry types**: Strongly typed i18n dictionaries based on
  `@duckgen` message tags.

## How it works

1. Reads `duck-gen.json` from your project root (required).
2. Builds a TypeScript project from `tsconfigPath` (NestJS uses tsconfig includes/excludes; `sourceGlobs` are reserved).
3. Scans framework controllers and `@duckgen` message sources (arrays or objects).
4. Emits `.d.ts` files under `@gentleduck/gen/generated/<framework>`.
5. Prints warnings for `any` return types and duplicate message const names.

## Installation

<Steps>

<Step>Prerequisites</Step>

- Node 22 or newer.
- A TypeScript project with a valid `tsconfig.json`.
- NestJS (current testing target).

<Step>Install the package</Step>

```bash
pnpm add -D @gentleduck/gen
```

<Step>Add a script (optional)</Step>

```json title="package.json"
{
  "scripts": {
    "duck-gen": "duck-gen"
  }
}
```

</Steps>

## Quick start

<Steps>

<Step>Create duck-gen.json</Step>

```json title="duck-gen.json"
{
  "$schema": "node_modules/@gentleduck/gen/duck-gen.schema.json",
  "framework": "nestjs",
  "extensions": {
    "shared": {
      "includeNodeModules": false,
      "outputSource": "./generated",
      "sourceGlobs": ["src/**/*.ts", "src/**/*.tsx"],
      "tsconfigPath": "./tsconfig.json"
    },
    "apiRoutes": {
      "enabled": true,
      "globalPrefix": "/api",
      "normalizeAnyToUnknown": true,
      "outputSource": "./generated"
    },
    "messages": {
      "enabled": true,
      "outputSource": "./generated"
    }
  }
}
```

<Step>Run the generator</Step>

```bash
pnpm exec duck-gen
```

<Step>Import generated types</Step>

```ts
import type { RouteReq, RouteRes } from '@gentleduck/gen/nestjs'
```

</Steps>

## Configuration

Duck Gen reads `duck-gen.json` from your project root. The config file is required,
and paths are resolved relative to the config file.

```json title="duck-gen.json"
{
  "$schema": "node_modules/@gentleduck/gen/duck-gen.schema.json",
  "framework": "nestjs",
  "extensions": {
    "shared": {
      "includeNodeModules": false,
      "outputSource": "./generated",
      "sourceGlobs": ["src/**/*.ts", "src/**/*.tsx"],
      "tsconfigPath": "./tsconfig.json"
    },
    "apiRoutes": {
      "enabled": true,
      "globalPrefix": "/api",
      "normalizeAnyToUnknown": true,
      "outputSource": "./generated"
    },
    "messages": {
      "enabled": true,
      "outputSource": "./generated"
    }
  }
}
```

**Root**

- `framework` (string, required): The target framework. Currently only `nestjs`
  is supported; other values fail validation.

**extensions.shared**

- `tsconfigPath` (string, required for NestJS scanning): TypeScript config used
  by ts-morph.
- `includeNodeModules` (boolean, required): Include `node_modules` in scanning.
- `sourceGlobs` (string[], reserved): Present in the schema but not applied by
  the current NestJS adapter.
- `outputSource` (string | string[]): Additional output directories for generated
  files (package outputs are always generated).

**extensions.apiRoutes**

- `enabled` (boolean, required): Enable API route generation.
- `globalPrefix` (string, optional): Prefix applied to all routes. Omit for no
  prefix.
- `normalizeAnyToUnknown` (boolean, required): Converts `any` request/response
  types to `unknown` and warns on `any` return types when enabled.
- `outputSource` (string | string[]): Additional output file path(s) or
  directories for generated API routes.
- `outputPath` (string, deprecated): Legacy output file path for API routes.
  Use `outputSource` instead.
- `sourceGlobs` (string[], reserved): Present in the schema but not applied by
  the current NestJS adapter.
- `tsconfigPath` (string, reserved): Present in the schema but not applied by
  the current NestJS adapter.
- `includeNodeModules` (boolean, reserved): Present in the schema but not
  applied by the current NestJS adapter.

**extensions.messages**

- `enabled` (boolean, required): Enable message generation.
- `outputSource` (string | string[]): Additional output file path(s) or
  directories for generated message types.
- `outputPath` (string, deprecated): Legacy output file path for messages.
  Use `outputSource` instead.
- `sourceGlobs` (string[], reserved): Present in the schema but not applied by
  the current NestJS adapter.
- `tsconfigPath` (string, reserved): Present in the schema but not applied by
  the current NestJS adapter.
- `includeNodeModules` (boolean, reserved): Present in the schema but not
  applied by the current NestJS adapter.

## Output and CLI

Duck Gen writes generated files inside the package:

- `@gentleduck/gen/generated/nestjs/duck-gen-api-routes.d.ts`
- `@gentleduck/gen/generated/nestjs/duck-gen-messages.d.ts`
- `@gentleduck/gen/generated/nestjs/index.d.ts`

Outputs are always written to the package `generated` folder. Use
`extensions.apiRoutes.outputSource` or `extensions.messages.outputSource` to
add extra output files or directories, or use `extensions.shared.outputSource`
for shared output directories. When you customize outputs, import types from
those paths instead of the package entrypoints.

Import the public entrypoint:

```ts
import type { ApiRoutes, DuckGenI18nMessages, DuckgenScopedI18nByGroup } from '@gentleduck/gen/nestjs'
```

CLI notes:

- `duck-gen.json` is required; the CLI fails if it cannot be read.
- Run the CLI from the project root so paths resolve correctly.
- Warnings are printed for `any` return types and duplicate message const names.
- Running the generator multiple times is safe; it overwrites the same files.

## Troubleshooting

- **No routes generated**: Make sure your decorators use string literal paths.
  Dynamic values are skipped.
- **Missing types**: Check `tsconfigPath` and the `include`/`exclude` globs in
  your `tsconfig.json`.
- **Message keys are just `string`**: Add `as const` to message arrays.
- **Duplicate group keys**: Ensure each `@duckgen` group key is unique.
- **Any return warnings**: Add explicit return types, or set
  `normalizeAnyToUnknown` to `false` if you want to allow `any` through.

## Extensions

- **API Routes**: [Read the API routes guide](/docs/duck-gen/api-routes).
- **Messages**: [Read the messages guide](/docs/duck-gen/messages).

## Contributing

Duck Gen lives in the Gentleduck monorepo. Issues, fixes, and documentation
improvements are welcome at [`@gentleduck`](https://github.com/gentleeduck/duck-ui.)
